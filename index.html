<html>
    <head>
        <script type="text/javascript" src="utilities/Strategy.js"></script>
        <script type="text/javascript" src="utilities/Trade.js"></script>
        <script type="text/javascript" src="utilities/Transaction.js"></script>
        <script type="text/javascript" src="utilities/Price.js"></script>
        <script type="text/javascript" src="utilities/StockAnalyser.js"></script>
        <link rel="stylesheet" href="css/style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script>
            $(document).ready(function() {

            });

            function clearOutput() {
                document.getElementById("history_canvas").innerHTML = "";
                document.getElementById("summary_canvas").innerHTML = "";
            }

            function executeAnalysis() {          
                var selectedValue = document.getElementById("stockSelect").value;
                var fund = Number(document.getElementById("fundBox").value);
                var filePath = "";
                switch (selectedValue) {
                    case "1": filePath = "stockdata/AAPL_2019.csv"; break;
                    case "2": filePath = "stockdata/AAPL_5years.csv"; break;
                    case "3": filePath = "stockdata/AAPL_10years.csv"; break;
                    case "4": filePath = "stockdata/PYPL_2019.csv"; break;
                    case "5": filePath = "stockdata/SPY_2019.csv"; break;
                }

                if (filePath != "") {
                    clearOutput();
                    $.ajax({
                        type: "GET",
                        url: filePath,
                        dataType: "text",
                        success: function(data) {
                            //var strategy = new Strategy([0.025, 0.025, 4.0, 0.025, Number.MAX_VALUE, Number.MAX_VALUE]);
                            var strategystring = document.getElementById("strategyBox").value;
                            var strategyArr = strategystring.split(',');
                            var strategyInput = [];
                            for (var i of strategyArr) {
                                i = i.trim();
                                if (i == "Number.MAX_VALUE") {
                                    strategyInput.push(Number.MAX_VALUE);
                                }
                                else {
                                    strategyInput.push(Number(i));
                                }
                            }
                            var strategy = new Strategy(strategyInput);

                            var stockAnalyser = new StockAnalyser(fund, 'history_canvas', 'summary_canvas');
                            stockAnalyser.loadStrategy(strategy);
                            stockAnalyser.processData(data);
                            stockAnalyser.applyStrategyContinuously(true);
                        },
                        error: function(data) {
                            alert(data);
                        }
                    });  
                }
            }
        </script>
    </head>
<title>Stock Analysis</title>

<body>
    <div class="split left">
        <div id="history_canvas" class="centered">
            <h2>Historical Transactions</h2>
            <hr>
        </div>
    </div>
    <div class="split right">
        <div id="summary_canvas" class="centered top">
            <h2>Summary</h2>
        </div>
        <div id="contro_panel" class="centered bottom">
            <h2>Control Panel</h2>
            <form>
                Investment: <input id="fundBox" value="30000" type="text" size="10"></br></br>
                Strategy: <input id="strategyBox" value="0.025, 0.025, 4.0, 0.025, Number.MAX_VALUE, Number.MAX_VALUE" type="text" size="100"></br></br>
                <select id="stockSelect" class="browser-default custom-select">
                    <option selected>------ select a stock ------</option>
                    <option value="1">AAPL 2019</option>
                    <option value="2">AAPL 5 Years</option>
                    <option value="3">AAPL 10 Years</option>
                    <option value="4">PYPL 2019</option>
                    <option value="5">SPY 2019</option>
                </select>
                <button type="button" onclick="executeAnalysis()">Analyze</button>
            </form>
        </div>
    </div>
</body>
</html>